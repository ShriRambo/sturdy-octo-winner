<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Door Sensor with ESP8266 and Reed Switch</title>
<meta name="generator" content="Org mode">
<meta name="description" content="Detect opening and closing of doors or windows with esp8266 and a reed switch"
>
<meta name="keywords" content="esp8266, mqtt, mosquitto, door sensor, window sensor, home automation, monitoring">
<link rel='stylesheet' href='./css/code.css' />
<link rel='stylesheet' href='./css/simple.css' />
<link rel='shortcut icon' href='./img/favicon.ico' type='image/x-icon' />
<link rel='stylesheet' href='https://cdn.jsdelivr.net/npm/fork-awesome@1.2.0/css/fork-awesome.min.css' integrity='sha256-XoaMnoYC5TH6/+ihMEnospgm0J1PM/nioxbOUdnM8HY=' crossorigin='anonymous'>
</head>
<body>
<header id="top" class="status">
<a href="./index.html">shrirambo</a>.<a href="https://github.com/shrirambo">github</a>.<a href="">io</a>/<a href="./index.html">home</a>/<a href="./index.html">blog</a>
</header>
<main id="content">
<h1 class="title">Door Sensor with ESP8266 and Reed Switch</h1>
<p>
Door sensors are incredibly valuable devices that serve multiple purposes. Not only do they enhance security monitoring, but they also allow for the setup of intelligent automations based on whether a door or window is open or closed.
</p>

<p>
The idea is simple. We have to program the microcontroller to detect the changes in the state of a switch, and use a switch that can turn on-off based on whether the door is open or closed. It can be as simple as a contact switch whch closes the circuit when the door is closed.
</p>

<p>
We will utilize a Reed Switch instead, a simple yet ingenious device that promptly responds to the presence of a magnetic field, whether it's generated by a permanent magnet or by electromagnet.
</p>


<section id="outline-container-org8696d23" class="outline-2">
<h2 id="org8696d23"><a href="#org8696d23">üß≠ The Problem</a></h2>
<div class="outline-text-2" id="text-org8696d23">
<p>
The minimal requirement for this project is as follows:
</p>

<ul class="org-ul">
<li><a href="https://www.wemos.cc/en/latest/d1/d1_mini.html">Wemos D1 Mini</a> (<code>ESP8266</code> based board)</li>
<li><p>
<a href="https://en.wikipedia.org/wiki/Reed_switch">Reed Switch</a>
</p>

<p>
This task is straightforward and requires a simple connection of the reed switch to a GPIO pin to detect state changes. The reed switch offers two variants: a <span class="underline">Normally Open</span> one that closes in the presence of a magnetic field, and a <span class="underline">Normally Closed</span> one that opens when exposed to a magnetic field. For this example, I am using a normally open switch, which will close when a magnet comes in the proximity.
</p></li>
</ul>
</div>
</section>

<section id="outline-container-orge253339" class="outline-2">
<h2 id="orge253339"><a href="#orge253339">üîå The Circuit</a></h2>
<div class="outline-text-2" id="text-orge253339">
<p>
The circuit diagram for this project is very simple. The reed switch comes with two ends, and all we need to do is connect one end to either the <code>GND</code> or <code>3.3V</code> pin, while the other one to a GPIO pin. Depending on where the first end is connected to, closing the switch will pull the GPIO pin to a low or a high. For this case, I am connecting one end to <code>GND</code> and one to <code>D1</code>.
</p>


<div id="org07b6793" class="figure">
<p><img src="./img/circuit-diagram-door-sensor.png" alt="circuit-diagram-door-sensor.png">
</p>
</div>

<p>
Now, here's something to consider. With the current circuit, when the switch is closed, <code>D1</code> will be pulled low, and it will remain low until it's manually pulled high by connecting it to <code>3.3V</code>. However, we want the desired behavior where the pin automatically gets pulled high when the switch is open. To achieve this, we'll need to use a pull-up resistor. The simplest way is to utilize the internal pull-up resistor by specifying pin mode <code>INPUT_PULLUP</code>.
</p>

<p>
Finally, we'll power the Wemos D1 Mini using a USB cable, but feel free to choose any other suitable power source as per your preference. With everything set up correctly, we are now ready to dive into the sketch.
</p>
</div>
</section>

<section id="outline-container-org9509cdc" class="outline-2">
<h2 id="org9509cdc"><a href="#org9509cdc">üêù The Code</a></h2>
<div class="outline-text-2" id="text-org9509cdc">
<p>
We define a variable <code>doorState</code> which will hold the current state of the door. More specifically the <code>doorPin</code> state. We can now detect the change in state by comparing <code>doorState</code> to <code>doorPin</code> state. The <code>doorPin</code> is set to mode <code>INPUT_PULLUP</code>. So, when no external signal is given to the pin, it defaults to HIGH. That is all the setup is needed.
</p>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-comment-delimiter">//</span><span class="org-comment">Reed switch</span>
<span class="org-keyword">const</span> <span class="org-type">int</span> <span class="org-variable-name">doorPin</span> = D1;
<span class="org-type">int</span> <span class="org-variable-name">doorState</span> = 2;

<span class="org-type">void</span> <span class="org-function-name">setup</span><span class="org-rainbow-delimiters-depth-1">()</span> <span class="org-rainbow-delimiters-depth-1">{</span>
  <span class="org-comment-delimiter">// </span><span class="org-comment">Serial setup</span>
  Serial.begin<span class="org-rainbow-delimiters-depth-2">(</span>115200<span class="org-rainbow-delimiters-depth-2">)</span>;
  Serial.println<span class="org-rainbow-delimiters-depth-2">()</span>;

  <span class="org-comment-delimiter">// </span><span class="org-comment">Reed switch setup</span>
  pinMode<span class="org-rainbow-delimiters-depth-2">(</span>doorPin, INPUT_PULLUP<span class="org-rainbow-delimiters-depth-2">)</span>;

<span class="org-rainbow-delimiters-depth-1">}</span>
</pre>
</div>

<p>
For the process loop, the esp reads the state of <code>doorPin</code> and compares it to the saved <code>doorState</code>. If it is not same, then the state has changed. If state has changed to a LOW, that means the switch is closed and if it changes to a HIGH, the switch is opened. 
</p>
<div class="org-src-container">
<pre class="src src-cpp"><span class="org-type">void</span> <span class="org-function-name">loop</span><span class="org-rainbow-delimiters-depth-1">()</span> <span class="org-rainbow-delimiters-depth-1">{</span>
  <span class="org-type">int</span> <span class="org-variable-name">readPin</span> = digitalRead<span class="org-rainbow-delimiters-depth-2">(</span>doorPin<span class="org-rainbow-delimiters-depth-2">)</span>;
  <span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-2">(</span>readPin != doorState<span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-rainbow-delimiters-depth-2">{</span>
    doorState = readPin;
    <span class="org-keyword">if</span><span class="org-rainbow-delimiters-depth-3">(</span>doorState == LOW<span class="org-rainbow-delimiters-depth-3">){</span>
      Serial.println<span class="org-rainbow-delimiters-depth-4">(</span><span class="org-string">"Door closed"</span><span class="org-rainbow-delimiters-depth-4">)</span>;
      <span class="org-comment-delimiter">// </span><span class="org-comment">Do stuff when door is closed</span>
    <span class="org-rainbow-delimiters-depth-3">}</span><span class="org-keyword">else</span> <span class="org-rainbow-delimiters-depth-3">{</span>
      Serial.println<span class="org-rainbow-delimiters-depth-4">(</span><span class="org-string">"Door opened"</span><span class="org-rainbow-delimiters-depth-4">)</span>;
      <span class="org-comment-delimiter">// </span><span class="org-comment">Do stuff when door is opened</span>
    <span class="org-rainbow-delimiters-depth-3">}</span>
  <span class="org-rainbow-delimiters-depth-2">}</span>
  delay<span class="org-rainbow-delimiters-depth-2">(</span>1000<span class="org-rainbow-delimiters-depth-2">)</span>
</pre>
</div>

<p>
As we are using a normally open switch, switch closed means door closed. As simple as that.
</p>
</div>
</section>
<section id="outline-container-org16ecee5" class="outline-2">
<h2 id="org16ecee5"><a href="#org16ecee5">üåØ The Wrap-up</a></h2>
<div class="outline-text-2" id="text-org16ecee5">
<p>
The beauty of this project lies in its simplicity and versatility. Now that we have the foundation set up, the possibilities are endless. You can easily add any logic you desire to this code, allowing you to achieve a wide range of exciting functionalities.
</p>

<p>
For instance, you can effortlessly publish the state of the door to an MQTT topic, enabling seamless integration with other smart devices or systems. Want to trigger an alarm when door opens? Add a tiny speaker to the controller. The flexibility of this code makes it a perfect fit for customizing it according to your preferences and needs.
</p>

<p>
And here's the best part: you can use the same code with any type of switch! Whether it's a reed switch like we've used here or any other type to detect changes in state and trigger an action.
</p>
</div>
</section>
</main>
<footer id="postamble" class="status">
<hr>
<section>
<script src="https://giscus.app/client.js" 
  data-repo="ShriRambo/giscus-comments"
  data-repo-id="R_kgDOG1mtrQ"
  data-category="Announcements" 
  data-category-id="DIC_kwDOG1mtrc4CBJNW" 
  data-mapping="title" 
  data-reactions-enabled="1" 
  data-emit-metadata="0" 
  data-input-position="top" 
  data-theme="dark" 
  data-lang="en" 
  crossorigin="anonymous" 
  async> </script>
</section>
<hr>
<section>
  <p style="text-align:center">
Made with ‚ù§Ô∏è and Emacs (Org-mode)
</p>
<div align=center>
  <a href="#" class='link-icon'>
    <i class="fa fa-home fa-lg" aria-hidden="true"></i>
  </a>
  <a href="https://www.instagram.com/shrirambo/" class='link-icon'>
    <i class="fa fa-instagram fa-lg" aria-hidden="true"></i>
  </a>
  <a href="https://github.com/shrirambo" class='link-icon'>
    <i class="fa fa-github fa-lg" aria-hidden="true"></i>
  </a>
  <a href='https://www.linkedin.com/in/shriram-ashirgade/' class='link-icon'>
    <i class="fa fa-linkedin-square fa-lg" aria-hidden="true"></i>
  </a>
  <a href='https://social.vivaldi.net/@shrirambo'>
    <i class="fa fa-mastodon fa-lg" aria-hidden="true"></i>
  </a>
  <a href='https://github.com/ShriRambo/sturdy-octo-winner/tree/master/content' class='link-icon'>
    <i class="fa fa-code  fa-lg" aria-hidden="true"></i>
  </a>
  <a href='#content' class='link-icon'>
    <i class="fa fa-hand-o-up  fa-lg" aria-hidden="true"></i>
  </a>
</div>
</div>
</footer>
</body>
</html>
